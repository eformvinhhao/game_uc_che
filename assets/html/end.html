<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="Javascript Custom Quiz">
  <meta name="keywords" content="Javascript, Quiz, Javascript Quiz">
  <meta name="author" content="Kirill Kuznetsov">
  <!-- Title -->
  <title>Chúc mừng!</title>
  <!-- Custom Styles -->
  <link rel="stylesheet" href="../css/app.css" />
  <!-- Favicon -->
  <link rel="icon" href="../img/favicon.ico" type="image/x-icon">
</head>

<body>

  <!-- Final Result -->
  <main class="container">
    <div id="end" class="flex-center flex-column">
      <h3>Số câu đúng</h3>
      <h2 id="so_cau_dung" style="color:green"></h2>
      <h3>Thời gian sử dụng (giây)</h3>
      <h2 id="thoi_gian_su_dung" style="color:red"></h2>
      <form class='form' >
        <input type="text" name="username" id="username" placeholder="Họ và tên" required />
        <input type="text" name="line" id="line" placeholder="Bộ phận/Dây chuyền" required="" />
        <input type="text" autocomplete="email" maxlength="60" id="email" required=""
          pattern="[^@]+@[^@]+\.[a-zA-Z]{2,6}" placeholder="Email cá nhân" />
        <button type="submit" class="btn" id="saveScoreBtn">Nộp kết quả</button>
      </form>
      <a class="btn" href="../html/game.html">Chơi lại</a>
      <a class="btn" href="../../index.html">Về trang chủ</a>
    </div>
  </main>
  
  <script src="../js/end.js"></script>

  <script src="https://d3js.org/d3.v7.min.js"></script>

  <script>
    d3.json("/ketqua.json", function (error, data) {
      if (error)
        throw error;
      console.log(data);
    });

    const username = document.getElementById("username");
    const email = document.getElementById("email");
    const line = document.getElementById("line");
    const saveScoreBtn = document.getElementById("saveScoreBtn");
    const correctScore = document.getElementById("correctScore");
    const so_cau_dung = document.getElementById("so_cau_dung");
    const thoi_gian_su_dung = document.getElementById("thoi_gian_su_dung");
    const so_cau_dung_luu = localStorage.getItem("so_cau_dung");
    const thoi_gian_su_dung_luu = localStorage.getItem("thoi_gian_su_dung");

    so_cau_dung.innerText = so_cau_dung_luu;
    thoi_gian_su_dung.innerText = thoi_gian_su_dung_luu;

    username.addEventListener("keyup", () => {
      saveScoreBtn.disabled = !username.value;
    });

    // Save High Score to Local Storage
    const formE1 = document.querySelector('.form');
    formE1.addEventListener('submit', event => {
      event.preventDefault();
      const submissionTime = new Date().toISOString();

      fetch('https://default810604757e7f4ede8d8dbf61f53ca5.28.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/d7d70bbb3ab14a008c7778e43d8a145a/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=LM2xlC3RCxGZSQY3EucnesZZdb6kuG1VL18cC-KRB9k', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          'Họ và tên': document.getElementById('username').value,
          'Email cá nhân': document.getElementById('email').value,
          'Thời gian nộp phiếu': submissionTime,
          'Line': document.getElementById("line").value,
          'Thời gian sử dụng': thoi_gian_su_dung_luu,
          'Số câu đúng': so_cau_dung_luu,
        })
      }).then(res => res.json())
        .then(data => console.log(data))
        .catch(error => console.log(error));
      alert("Đã gửi kết quả thành công");
      window.location.assign("../html/highscores.html");
    })
  </script>

</body>

</html>